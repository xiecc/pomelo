<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>pomelo API</title>
    <meta http-equiv='content-type' content='text/html' />
    <meta http-equiv='content-style-type' content='text/css' />
    <meta http-equiv='content-script-type' content='text/javascript' />
    <meta name='author' content='netease' />
    <meta name='version' content='1.0' />
    <meta name='keywords' content='' />
    <meta name='description' content='' />

    <link type='text/css' rel='stylesheet' href='css/base.css'>
    <link type='text/css' rel='stylesheet' href='css/api.css'>

    <script>
      var raw = [{"id":"9-1350527233714","name":"Pomelo","signiture":"Pomelo","type":"declaration","ctx":{"type":"declaration","name":"Pomelo","value":"module.exports = {}","string":"Pomelo"},"description":{"full":"<p>Expose <code>createApplication()</code>.</p>","summary":"<p>Expose <code>createApplication()</code>.</p>","body":""},"full_description":"<p>Expose <code>createApplication()</code>.</p>","code":"var Pomelo = module.exports = {};","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"13-1350527233714","name":"createApp","signiture":"Pomelo.createApp()","type":"method","ctx":{"type":"method","receiver":"Pomelo","name":"createApp","string":"Pomelo.createApp()"},"description":{"full":"<p>Create an pomelo application.</p>","summary":"<p>Create an pomelo application.</p>","body":""},"full_description":"<p>Create an pomelo application.</p>","code":"Pomelo.createApp = function () {\n    var app = application;\n    app.stack = [].slice.apply(arguments);\n    app.init();\n    self.app = app;\n    return app;\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Application"],"description":""},{"type":"memberOf","parent":"Pomelo"},{"type":"api","visibility":"public"}],"module":false,"parent":"Pomelo","related":{"href":""},"has_related":true}]},{"id":"18-1350527233714","name":"StatusService","signiture":"StatusService","type":"declaration","ctx":{"type":"declaration","name":"StatusService","value":"module.exports","string":"StatusService"},"description":{"full":"<p>Status service.<br />keep all connection infos in memory.<br />only one connection at the same time for each account. latest login will kick the old one off.</p>","summary":"<p>Status service.<br />keep all connection infos in memory.<br />only one connection at the same time for each account. latest login will kick the old one off.</p>","body":""},"full_description":"<p>Status service. keep all connection infos in memory. only one connection at the same time for each account. latest login will kick the old one off.</p>","code":"var StatusService = module.exports;","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"20-1350527233714","name":"addStatus","signiture":"StatusService.addStatus()","type":"method","ctx":{"type":"method","receiver":"StatusService","name":"addStatus","string":"StatusService.addStatus()"},"description":{"full":"<p>Add uid and serverId pair into status records<br />kick the old login if any.</p>","summary":"<p>Add uid and serverId pair into status records<br />kick the old login if any.</p>","body":""},"full_description":"<p>Add uid and serverId pair into status records kick the old login if any.</p>","code":"StatusService.addStatus = function(uid, sid, cb) {\n\tlogger.debug('add satus:' + uid + ', ' + sid);\n\tvar oldSid = uidMap[uid];\n\n\tfunction addNewStatus(err) {\n\t\tif(!err) {\n\t\t\tuidMap[uid] = sid;\n\t\t}\n\t\tutils.invokeCallback(cb, err);\n\t}\n\n\tif(!!oldSid) {\n\t\tkick(uid, oldSid, addNewStatus);\n\t} else {\n\t\taddNewStatus();\n\t}\n\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Stirng"],"name":"serverId","description":"sid"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Stirng"],"name":"serverId","description":"sid"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"memberOf","parent":"StatusService"}],"module":false,"parent":"StatusService","related":{"href":""},"has_related":true},{"id":"21-1350527233714","name":"removeStatus","signiture":"StatusService.removeStatus()","type":"method","ctx":{"type":"method","receiver":"StatusService","name":"removeStatus","string":"StatusService.removeStatus()"},"description":{"full":"<p>Remove status record by uid</p>","summary":"<p>Remove status record by uid</p>","body":""},"full_description":"<p>Remove status record by uid</p>","code":"StatusService.removeStatus = function(uid, cb) {\n\tdelete uidMap[uid];\n\n\tutils.invokeCallback(cb);\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Function"],"name":"cb(err)","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Function"],"name":"cb(err)","description":"callback function"},{"type":"memberOf","parent":"StatusService"}],"module":false,"parent":"StatusService","related":{"href":""},"has_related":true},{"id":"22-1350527233714","name":"queryStatus","signiture":"StatusService.queryStatus()","type":"method","ctx":{"type":"method","receiver":"StatusService","name":"queryStatus","string":"StatusService.queryStatus()"},"description":{"full":"<p>Query status by uid</p>","summary":"<p>Query status by uid</p>","body":""},"full_description":"<p>Query status by uid</p>","code":"StatusService.queryStatus = function(uid, cb) {\n\tutils.invokeCallback(cb, null, uidMap[uid]);\n};","params":[{"type":"param","types":["String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"uid","description":"user id"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"memberOf","parent":"StatusService"}],"module":false,"parent":"StatusService","related":{"href":""},"has_related":true},{"id":"23-1350527233714","name":"queryStatusBatch","signiture":"StatusService.queryStatusBatch()","type":"method","ctx":{"type":"method","receiver":"StatusService","name":"queryStatusBatch","string":"StatusService.queryStatusBatch()"},"description":{"full":"<p>Query status by uids</p>","summary":"<p>Query status by uids</p>","body":""},"full_description":"<p>Query status by uids</p>","code":"StatusService.queryStatusBatch = function(uids, cb) {\n\tvar result = {};\n\tvar missing = [];\n\n\tvar sid, list;\n\tfor(var i=0, l=uids.length; i<l; i++) {\n\t\tsid = uidMap[uids[i]];\n\t\tif(!sid) {\n\t\t\tmissing.push(uids[i]);\n\t\t\tcontinue;\n\t\t}\n\n\t\tlist = result[sid];\n\t\tif(!list) {\n\t\t\tlist = [];\n\t\t\tresult[sid] = list;\n\t\t}\n\t\tlist.push(uids[i]);\n\t}\n\n\tutils.invokeCallback(cb, null, result, missing);\n};","params":[{"type":"param","types":["Array"],"name":"uids","description":"list of uid"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err, result, missing) result:{sid:[uid]}, missing:[missingUid]"}],"has_params":true,"tags":[{"type":"param","types":["Array"],"name":"uids","description":"list of uid"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err, result, missing) result:{sid:[uid]}, missing:[missingUid]"},{"type":"memberOf","parent":"StatusService"}],"module":false,"parent":"StatusService","related":{"href":""},"has_related":true}]},{"id":"25-1350527233714","name":"SessionService","signiture":"SessionService","type":"declaration","ctx":{"type":"declaration","name":"SessionService","value":"module.exports","string":"SessionService"},"description":{"full":"<p>Manager session.</p>","summary":"<p>Manager session.</p>","body":""},"full_description":"<p>Manager session.</p>","code":"var SessionService = module.exports;","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"36-1350527233714","name":"createSession","signiture":"SessionService.createSession()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"createSession","string":"SessionService.createSession()"},"description":{"full":"<p>Create and return session.</p>","summary":"<p>Create and return session.</p>","body":""},"full_description":"<p>Create and return session.</p>","code":"SessionService.createSession = function(opts, force) {\n\tif(!opts || !opts.key) {\n\t\tthrow new Error('opts or opts.key should not be empty.');\n\t}\n\n\tif(!!socketMap[opts.key] && !force) {\n\t\treturn null;\n\t}\n\n\tvar session = new InterSession(opts);\n\tsocketMap[opts.key] = session;\n\treturn session;\n};","params":[{"type":"param","types":["Object"],"name":"opts","description":"{key:obj, uid: str, and etc.}"},{"type":"param","types":["Boolean"],"name":"force","description":"whether replace the origin session if it already existed"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"opts","description":"{key:obj, uid: str, and etc.}"},{"type":"param","types":["Boolean"],"name":"force","description":"whether replace the origin session if it already existed"},{"type":"return","types":["InterSession"],"description":""},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"37-1350527233714","name":"getSession","signiture":"SessionService.getSession()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"getSession","string":"SessionService.getSession()"},"description":{"full":"<p>Get session by key.</p>","summary":"<p>Get session by key.</p>","body":""},"full_description":"<p>Get session by key.</p>","code":"SessionService.getSession = function(key) {\n\treturn socketMap[key];\n};","params":[{"type":"param","types":["Number"],"name":"key","description":"the session' key"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"key","description":"the session' key"},{"type":"return","types":["InterSession"],"description":""},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"38-1350527233714","name":"getSessionByUid","signiture":"SessionService.getSessionByUid()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"getSessionByUid","string":"SessionService.getSessionByUid()"},"description":{"full":"<p>Get session by userId.</p>","summary":"<p>Get session by userId.</p>","body":""},"full_description":"<p>Get session by userId.</p>","code":"SessionService.getSessionByUid = function(uid) {\n\treturn uidMap[uid];\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"userId"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"return","types":["InterSession"],"description":""},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"39-1350527233714","name":"removeSession","signiture":"SessionService.removeSession()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"removeSession","string":"SessionService.removeSession()"},"description":{"full":"<p>Remove session by key.</p>","summary":"<p>Remove session by key.</p>","body":""},"full_description":"<p>Remove session by key.</p>","code":"SessionService.removeSession = function(key) {\n\tdelete socketMap[key];\n};","params":[{"type":"param","types":["Number"],"name":"key","description":"the session' key"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"key","description":"the session' key"},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"40-1350527233714","name":"kick","signiture":"SessionService.kick()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"kick","string":"SessionService.kick()"},"description":{"full":"<p>Kick a user offline.</p>","summary":"<p>Kick a user offline.</p>","body":""},"full_description":"<p>Kick a user offline.</p>","code":"SessionService.kick = function(uid, cb) {\n\tlogger.debug('kick off user:' + uid);\n\tvar session = SessionService.getSessionByUid(uid);\n\n\tfunction afterKick() {\n\t\tutils.invokeCallback(cb);\n\t}\n\n\tif(!!session) {\n\t\t//make sure has been kicked\n\t\tkick(session);\n\t}\n\tprocess.nextTick(afterKick);\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"param","types":["Function"],"name":"cb","description":"callback function"},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"41-1350527233714","name":"sendMessage","signiture":"SessionService.sendMessage()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"sendMessage","string":"SessionService.sendMessage()"},"description":{"full":"<p>Send message to the client by session id.</p>","summary":"<p>Send message to the client by session id.</p>","body":""},"full_description":"<p>Send message to the client by session id.</p>","code":"SessionService.sendMessage = function(id, msg) {\n\tif(!socketMap[id]) {\n\t\tlogger.error('fail to send message for socket not exits');\n\t\treturn false;\n\t}\n\n\tif(!!SessionService.sendDirectly) {\n\t\tsocketMap[id].socket.send(encode(msg));\n\t\treturn true;\n\t}\n\n\tvar queue = msgQueues[id];\n\tif(!queue) {\n\t\tqueue = [];\n\t\tmsgQueues[id] = queue;\n\t}\n\n\tqueue.push(msg);\n\treturn true;\n};","params":[{"type":"param","types":["String"],"name":"id","description":"session id"},{"type":"param","types":["Object"],"name":"msg","description":"message to send"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"id","description":"session id"},{"type":"param","types":["Object"],"name":"msg","description":"message to send"},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true},{"id":"42-1350527233714","name":"sendMessageByUid","signiture":"SessionService.sendMessageByUid()","type":"method","ctx":{"type":"method","receiver":"SessionService","name":"sendMessageByUid","string":"SessionService.sendMessageByUid()"},"description":{"full":"<p>Send message to the client by user id.</p>","summary":"<p>Send message to the client by user id.</p>","body":""},"full_description":"<p>Send message to the client by user id.</p>","code":"SessionService.sendMessageByUid = function(uid, msg) {\n\tvar session = uidMap[uid];\n\tif(!session) {\n\t\tlogger.error('fail to send message by uid for session not exist. uid: %j', uid);\n\t\treturn false;\n\t}\n\n\treturn SessionService.sendMessage(session.key, msg);\n};","params":[{"type":"param","types":["String"],"name":"uid","description":"userId"},{"type":"param","types":["Object"],"name":"msg","description":"message to send"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"uid","description":"userId"},{"type":"param","types":["Object"],"name":"msg","description":"message to send"},{"type":"memberOf","parent":"SessionService"}],"module":false,"parent":"SessionService","related":{"href":""},"has_related":true}]},{"id":"26-1350527233714","name":"InterSession","signiture":"InterSession()","type":"function","ctx":{"type":"function","name":"InterSession","string":"InterSession()"},"description":{"full":"<p>Interal session class.</p>","summary":"<p>Interal session class.</p>","body":""},"full_description":"<p>Interal session class.</p>","code":"var InterSession = function(opts) {\n\tEventEmitter.call(this);\n\tthis.uid = '';\n\tfor(var f in opts) {\n\t\tthis[f] = opts[f];\n\t}\n};\nutil.inherits(InterSession, EventEmitter);","params":[],"has_params":false,"tags":[{"type":"class","string":""},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"27-1350527233714","name":"exportSession","signiture":"InterSession.prototype.exportSession()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"exportSession","string":"InterSession.prototype.exportSession()"},"description":{"full":"<p>Export session's data field except key and socket.</p>","summary":"<p>Export session's data field except key and socket.</p>","body":""},"full_description":"<p>Export session's data field except key and socket.</p>","code":"InterSession.prototype.exportSession = function() {\n\tvar res = {};\n\n\tfor(var f in this) {\n\t\tif(f === 'key' || f === 'socket' || typeof this[f] === 'function') {\n\t\t\tcontinue;\n\t\t}\n\n\t\tres[f] = this[f];\n\t}\n\t  \n\treturn res;\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"28-1350527233714","name":"cloneSession","signiture":"InterSession.prototype.cloneSession()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"cloneSession","string":"InterSession.prototype.cloneSession()"},"description":{"full":"<p>Clone session.</p>","summary":"<p>Clone session.</p>","body":""},"full_description":"<p>Clone session.</p>","code":"InterSession.prototype.cloneSession = function() {\n\tvar res = {};\n\n\tfor(var f in this) {\n\t\tres[f] = this[f];\n\t}\n\n\treturn res;\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"29-1350527233714","name":"bind","signiture":"InterSession.prototype.bind()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"bind","string":"InterSession.prototype.bind()"},"description":{"full":"<p>Bind the session with the the uid.</p>","summary":"<p>Bind the session with the the uid.</p>","body":""},"full_description":"<p>Bind the session with the the uid.</p>","code":"InterSession.prototype.bind = function(uid) {\n\t//get origin session instance\n\tvar session = SessionService.getSession(this.key);\n\tif(!session) {\n\t\treturn false;\n\t}\n\n\tif(session.uid) {\n\t\treturn false;\n\t}\n\tset(this, 'uid', uid);\n\tuidMap[uid] = session;\n\tthis.emit('bind', session);\n\treturn true;\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"userId"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"userId"},{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"30-1350527233714","name":"set","signiture":"InterSession.prototype.set()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"set","string":"InterSession.prototype.set()"},"description":{"full":"<p>Set value for the session.</p>","summary":"<p>Set value for the session.</p>","body":""},"full_description":"<p>Set value for the session.</p>","code":"InterSession.prototype.set = function(key, value) {\n\tset(this, key, value);\n};","params":[{"type":"param","types":["String"],"name":"key","description":"session key"},{"type":"param","types":["Object"],"name":"value","description":"session key"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"key","description":"session key"},{"type":"param","types":["Object"],"name":"value","description":"session key"},{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"31-1350527233714","name":"on","signiture":"InterSession.prototype.on()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"on","string":"InterSession.prototype.on()"},"description":{"full":"<p>Bind event for the session.</p>","summary":"<p>Bind event for the session.</p>","body":""},"full_description":"<p>Bind event for the session.</p>","code":"InterSession.prototype.on = function() {\n\tvar session = SessionService.getSession(this.key);\n\tif(!session) {\n\t\treturn false;\n\t}\n\tEventEmitter.prototype.on.apply(session, arguments);\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"32-1350527233714","name":"emit","signiture":"InterSession.prototype.emit()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"emit","string":"InterSession.prototype.emit()"},"description":{"full":"<p>Emit a event for the session.</p>","summary":"<p>Emit a event for the session.</p>","body":""},"full_description":"<p>Emit a event for the session.</p>","code":"InterSession.prototype.emit = function() {\n\tvar session = SessionService.getSession(this.key);\n\tif(!session) {\n\t\treturn false;\n\t}\n\tEventEmitter.prototype.emit.apply(session, arguments);\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"33-1350527233714","name":"closing","signiture":"InterSession.prototype.closing()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"closing","string":"InterSession.prototype.closing()"},"description":{"full":"<p>Closing callback for the session.</p>","summary":"<p>Closing callback for the session.</p>","body":""},"full_description":"<p>Closing callback for the session.</p>","code":"InterSession.prototype.closing = function() {\n\tvar reason = this.isKicked ? 'kick' : null;\n\tthis.emit('closing', this, reason);\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true},{"id":"34-1350527233714","name":"closed","signiture":"InterSession.prototype.closed()","type":"method","ctx":{"type":"method","constructor":"InterSession","name":"closed","string":"InterSession.prototype.closed()"},"description":{"full":"<p>Closed callback for the session.</p>","summary":"<p>Closed callback for the session.</p>","body":""},"full_description":"<p>Closed callback for the session.</p>","code":"InterSession.prototype.closed = function() {\n\tif(!!this._closed) {\n\t\treturn;\n\t}\n\tset(this, '_closed', true);\n\tset(this, 'uid', null);\n\tdelete socketMap[this.key];\n\tdelete msgQueues[this.key];\n\n\tvar reason = this.isKicked ? 'kick' : null;\n\tthis.emit('closed', this, reason);\n};","params":[],"has_params":false,"tags":[{"type":"api","visibility":"public"}],"module":false,"parent":"InterSession","related":{"href":""},"has_related":true}]},{"id":"52-1350527233714","name":"ChannelManager","signiture":"ChannelManager","type":"declaration","ctx":{"type":"declaration","name":"ChannelManager","value":"module.exports","string":"ChannelManager"},"description":{"full":"<p>Manager and maintain channel.</p>","summary":"<p>Manager and maintain channel.</p>","body":""},"full_description":"<p>Manager and maintain channel.</p>","code":"var ChannelManager = module.exports;","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"59-1350527233714","name":"createChannel","signiture":"ChannelManager.createChannel()","type":"method","ctx":{"type":"method","receiver":"ChannelManager","name":"createChannel","string":"ChannelManager.createChannel()"},"description":{"full":"<p>Create channel with name.</p>","summary":"<p>Create channel with name.</p>","body":""},"full_description":"<p>Create channel with name.</p>","code":"ChannelManager.createChannel = function(name) {\n\tif(!!channels[name]) {\n\t\treturn channels[name];\n\t}\n\n\tvar c = new Channel(name);\n\tchannels[name] = c;\n\treturn c;\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel's name"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"memberOf","parent":"ChannelManager"}],"module":false,"parent":"ChannelManager","related":{"href":""},"has_related":true},{"id":"60-1350527233714","name":"getChannel","signiture":"ChannelManager.getChannel()","type":"method","ctx":{"type":"method","receiver":"ChannelManager","name":"getChannel","string":"ChannelManager.getChannel()"},"description":{"full":"<p>Get channel by name.</p>","summary":"<p>Get channel by name.</p>","body":""},"full_description":"<p>Get channel by name.</p>","code":"ChannelManager.getChannel = function(name, create) {\n  var channel = channels[name];\n  if(!channel && !!create) {\n    channel = channels[name] = new Channel(name);\n  }\n\treturn channel;\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"param","types":["Boolean"],"name":"create","description":"if true, create channel"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel's name"},{"type":"param","types":["Boolean"],"name":"create","description":"if true, create channel"},{"type":"return","types":["Channel"],"description":""},{"type":"memberOf","parent":"ChannelManager"}],"module":false,"parent":"ChannelManager","related":{"href":""},"has_related":true},{"id":"61-1350527233714","name":"destroyChannel","signiture":"ChannelManager.destroyChannel()","type":"method","ctx":{"type":"method","receiver":"ChannelManager","name":"destroyChannel","string":"ChannelManager.destroyChannel()"},"description":{"full":"<p>Destroy channel by name.</p>","summary":"<p>Destroy channel by name.</p>","body":""},"full_description":"<p>Destroy channel by name.</p>","code":"ChannelManager.destroyChannel = function(name) {\n  delete channels[name];\n};","params":[{"type":"param","types":["String"],"name":"name","description":"channel' name"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"name","description":"channel' name"},{"type":"memberOf","parent":"ChannelManager"}],"module":false,"parent":"ChannelManager","related":{"href":""},"has_related":true},{"id":"62-1350527233714","name":"pushMessageByUids","signiture":"ChannelManager.pushMessageByUids()","type":"method","ctx":{"type":"method","receiver":"ChannelManager","name":"pushMessageByUids","string":"ChannelManager.pushMessageByUids()"},"description":{"full":"<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>","summary":"<p>Push message by uids.<br />Group the uids by group. ignore any uid if sid not specified.</p>","body":""},"full_description":"<p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>","code":"ChannelManager.pushMessageByUids = function(msg, uids, cb) {\n\tif(!uids || uids.length === 0) {\n\t\tutils.invokeCallback(cb, new Error('uids should not be empty'));\n\t\treturn;\n\t}\n\tvar groups = {}, record;\n\tfor(var i=0, l=uids.length; i<l; i++) {\n\t\trecord = uids[i];\n\t\tadd(record.uid, record.sid, groups);\n\t}\n\n\tsendMessageByGroup(msg, groups, cb);\n};","params":[{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"[{uid: userId, sid: serverId}]"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"[{uid: userId, sid: serverId}]"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"},{"type":"memberOf","parent":"ChannelManager"}],"module":false,"parent":"ChannelManager","related":{"href":""},"has_related":true}]},{"id":"54-1350527233714","name":"Channel","signiture":"Channel()","type":"function","ctx":{"type":"function","name":"Channel","string":"Channel()"},"description":{"full":"<p>Channel  maintains a number of user informations: userId, serverId and their mapping. <br /><br />It is used to  broadcast message to users in the channel. </p>","summary":"<p>Channel  maintains a number of user informations: userId, serverId and their mapping. <br /><br />It is used to  broadcast message to users in the channel. </p>","body":""},"full_description":"<p>Channel  maintains a number of user informations: userId, serverId and their mapping.   It is used to  broadcast message to users in the channel. </p>","code":"var Channel = function(name) {\n\tthis.groups = {};\t\t\t//group map for uids. key: sid, value: [uid]\n\tthis.state = ST_INITED;\n};","params":[],"has_params":false,"tags":[{"type":"class","string":"channel"},{"type":"constructor","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"55-1350527233714","name":"add","signiture":"Channel.prototype.add()","type":"method","ctx":{"type":"method","constructor":"Channel","name":"add","string":"Channel.prototype.add()"},"description":{"full":"<p>Add user to channel.</p>","summary":"<p>Add user to channel.</p>","body":""},"full_description":"<p>Add user to channel.</p>","code":"Channel.prototype.add = function(uid, sid) {\n  if(this.state > ST_INITED) {\n    return false;\n  } else {\n    return add(uid, sid, this.groups);\n  }\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to"}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"56-1350527233714","name":"leave","signiture":"Channel.prototype.leave()","type":"method","ctx":{"type":"method","constructor":"Channel","name":"leave","string":"Channel.prototype.leave()"},"description":{"full":"<p>Remove user from channel.</p>","summary":"<p>Remove user from channel.</p>","body":""},"full_description":"<p>Remove user from channel.</p>","code":"Channel.prototype.leave = function(uid, sid) {\n\treturn deleteFrom(uid, sid, this.groups[sid]);\n};","params":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to. "}],"has_params":true,"tags":[{"type":"param","types":["Number"],"name":"uid","description":"user id"},{"type":"param","types":["String"],"name":"sid","description":"frontend server id which user has connected to. "},{"type":"return","types":["[Boolean]"],"description":"true if success or false if fail"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true},{"id":"57-1350527233714","name":"destroy","signiture":"Channel.prototype.destroy()","type":"method","ctx":{"type":"method","constructor":"Channel","name":"destroy","string":"Channel.prototype.destroy()"},"description":{"full":"<p>Destroy channel.</p>","summary":"<p>Destroy channel.</p>","body":""},"full_description":"<p>Destroy channel.</p>","code":"Channel.prototype.destroy = function() {\n  this.state = ST_DESTROYED;\n  ChannelManager.destroyChannel(this.name);\n};","params":[],"has_params":false,"tags":[],"module":false,"parent":"Channel","has_related":false},{"id":"58-1350527233714","name":"pushMessage","signiture":"Channel.prototype.pushMessage()","type":"method","ctx":{"type":"method","constructor":"Channel","name":"pushMessage","string":"Channel.prototype.pushMessage()"},"description":{"full":"<p>Push message to all the members in the channel</p>","summary":"<p>Push message to all the members in the channel</p>","body":""},"full_description":"<p>Push message to all the members in the channel</p>","code":"Channel.prototype.pushMessage = function(msg, cb) {\n\tsendMessageByGroup(msg, this.groups, cb);\n};","params":[{"type":"param","types":["msg"],"name":"{Object}","description":"message that would be sent to client"},{"type":"param","types":["cb"],"name":"{Functioin}","description":"cb(err)"}],"has_params":true,"tags":[{"type":"param","types":["msg"],"name":"{Object}","description":"message that would be sent to client"},{"type":"param","types":["cb"],"name":"{Functioin}","description":"cb(err)"}],"module":false,"parent":"Channel","related":{"href":""},"has_related":true}]},{"id":"66-1350527233714","name":"ChannelService","signiture":"ChannelService","type":"declaration","ctx":{"type":"declaration","name":"ChannelService","value":"module.exports","string":"ChannelService"},"description":{"full":"<p>Manager localChannel and push message.</p>","summary":"<p>Manager localChannel and push message.</p>","body":""},"full_description":"<p>Manager localChannel and push message.</p>","code":"var ChannelService = module.exports;","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"67-1350527233714","name":"getLocalChannelSync","signiture":"ChannelService.getLocalChannelSync()","type":"method","ctx":{"type":"method","receiver":"ChannelService","name":"getLocalChannelSync","string":"ChannelService.getLocalChannelSync()"},"description":{"full":"<p>Get local channel instance.</p>","summary":"<p>Get local channel instance.</p>","body":""},"full_description":"<p>Get local channel instance.</p>","code":"ChannelService.getLocalChannelSync = function(opts) {\n  return channelManager.getChannel(opts.name, opts.create);\n};","params":[{"type":"param","types":["Object"],"name":"opts","description":"channel info parameters {name: channelName, create: createIfNotExist}"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"opts","description":"channel info parameters {name: channelName, create: createIfNotExist}"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true},{"id":"68-1350527233714","name":"pushMessageByUids","signiture":"ChannelService.pushMessageByUids()","type":"method","ctx":{"type":"method","receiver":"ChannelService","name":"pushMessageByUids","string":"ChannelService.pushMessageByUids()"},"description":{"full":"<p>Push message by uids.<br />Group the uids by group. query status server for sid if sid not specified.</p>","summary":"<p>Push message by uids.<br />Group the uids by group. query status server for sid if sid not specified.</p>","body":""},"full_description":"<p>Push message by uids. Group the uids by group. query status server for sid if sid not specified.</p>","code":"ChannelService.pushMessageByUids = function(msg, uids, cb) {\n  channelManager.pushMessageByUids(msg, uids, cb);\n};","params":[{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"[{uid: userId, sid: serverId}] or [uids]"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"}],"has_params":true,"tags":[{"type":"param","types":["Object"],"name":"msg","description":"message that would be sent to client"},{"type":"param","types":["Array"],"name":"uids","description":"[{uid: userId, sid: serverId}] or [uids]"},{"type":"param","types":["Function"],"name":"cb","description":"cb(err)"},{"type":"memberOf","parent":"ChannelService"}],"module":false,"parent":"ChannelService","related":{"href":""},"has_related":true}]},{"id":"145-1350527233715","name":"Application","signiture":"Application","type":"declaration","ctx":{"type":"declaration","name":"Application","value":"module.exports = {}","string":"Application"},"description":{"full":"<p>Application prototype.</p>","summary":"<p>Application prototype.</p>","body":""},"full_description":"<p>Application prototype.</p>","code":"var Application = module.exports = {};","params":[],"has_params":false,"tags":[{"type":"module","string":""}],"module":true,"related":{"href":""},"has_related":true,"methods":[{"id":"156-1350527233716","name":"set","signiture":"Application.set()","type":"method","ctx":{"type":"method","receiver":"Application","name":"set","string":"Application.set()"},"description":{"full":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.<br />Mounted servers inherit their parent server's settings.</p>","summary":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.<br />Mounted servers inherit their parent server's settings.</p>","body":""},"full_description":"<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value. Mounted servers inherit their parent server's settings.</p>","code":"Application.set = function (setting, val) {\n\tif (1 == arguments.length) {\n\t\tif (this.settings.hasOwnProperty(setting)) {\n\t\t\treturn this.settings[setting];\n\t\t} else if (this.parent) {\n\t\t\treturn this.parent.set(setting);\n\t\t}\n\t} else {\n\t\tthis.settings[setting] = val;\n\t\tthis[setting] = val;\n\t\treturn this;\n\t}\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"the setting of application"},{"type":"param","types":["String"],"name":"val","description":"the setting's value"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"the setting of application"},{"type":"param","types":["String"],"name":"val","description":"the setting's value"},{"type":"return","types":["Server","Mixed"],"description":"for chaining, or the setting value"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"159-1350527233716","name":"get","signiture":"Application.get()","type":"method","ctx":{"type":"method","receiver":"Application","name":"get","string":"Application.get()"},"description":{"full":"<p>Get property from setting</p>","summary":"<p>Get property from setting</p>","body":""},"full_description":"<p>Get property from setting</p>","code":"Application.get = function (setting) {\n\tvar val = this.settings[setting];\n\treturn val;\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["String"],"description":"val"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"160-1350527233716","name":"enabled","signiture":"Application.enabled()","type":"method","ctx":{"type":"method","receiver":"Application","name":"enabled","string":"Application.enabled()"},"description":{"full":"<p>Check if <code>setting</code> is enabled.</p>","summary":"<p>Check if <code>setting</code> is enabled.</p>","body":""},"full_description":"<p>Check if <code>setting</code> is enabled.</p>","code":"Application.enabled = function (setting) {\n\treturn !!this.set(setting);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"161-1350527233716","name":"disabled","signiture":"Application.disabled()","type":"method","ctx":{"type":"method","receiver":"Application","name":"disabled","string":"Application.disabled()"},"description":{"full":"<p>Check if <code>setting</code> is disabled.</p>","summary":"<p>Check if <code>setting</code> is disabled.</p>","body":""},"full_description":"<p>Check if <code>setting</code> is disabled.</p>","code":"Application.disabled = function (setting) {\n\treturn !this.set(setting);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["Boolean"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"162-1350527233716","name":"enable","signiture":"Application.enable()","type":"method","ctx":{"type":"method","receiver":"Application","name":"enable","string":"Application.enable()"},"description":{"full":"<p>Enable <code>setting</code>.</p>","summary":"<p>Enable <code>setting</code>.</p>","body":""},"full_description":"<p>Enable <code>setting</code>.</p>","code":"Application.enable = function (setting) {\n\treturn this.set(setting, true);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["app"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"164-1350527233716","name":"disable","signiture":"Application.disable()","type":"method","ctx":{"type":"method","receiver":"Application","name":"disable","string":"Application.disable()"},"description":{"full":"<p>Disable <code>setting</code>.</p>","summary":"<p>Disable <code>setting</code>.</p>","body":""},"full_description":"<p>Disable <code>setting</code>.</p>","code":"Application.disable = function (setting) {\n\treturn this.set(setting, false);\n};","params":[{"type":"param","types":["String"],"name":"setting","description":"application setting"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"setting","description":"application setting"},{"type":"return","types":["app"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"165-1350527233716","name":"configure","signiture":"Application.configure()","type":"method","ctx":{"type":"method","receiver":"Application","name":"configure","string":"Application.configure()"},"description":{"full":"<p>Configure callback for the specified env and server type. <br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified <br />that callback will be invoked for all server types. </p>\n\n<h2>Examples</h2>\n\n<p>app.configure(function(){<br />     // executed for all envs and server types<br />   });</p>\n\n<p>app.configure('development', function(){<br />     // executed development env<br />   });</p>\n\n<p>app.configure('development', 'connector', function(){<br />     // executed for development env and connector server type<br />   });</p>","summary":"<p>Configure callback for the specified env and server type. <br />When no env is specified that callback will<br />be invoked for all environments and when no type is specified <br />that callback will be invoked for all server types. </p>","body":"<h2>Examples</h2>\n\n<p>app.configure(function(){<br />     // executed for all envs and server types<br />   });</p>\n\n<p>app.configure('development', function(){<br />     // executed development env<br />   });</p>\n\n<p>app.configure('development', 'connector', function(){<br />     // executed for development env and connector server type<br />   });</p>"},"full_description":"<p>Configure callback for the specified env and server type.  When no env is specified that callback will be invoked for all environments and when no type is specified  that callback will be invoked for all server types. </p>\n\n<h2>Examples</h2>\n\n<p>app.configure(function(){      // executed for all envs and server types    });</p>\n\n<p>app.configure('development', function(){      // executed development env    });</p>\n\n<p>app.configure('development', 'connector', function(){      // executed for development env and connector server type    });</p>","code":"Application.configure = function (env, type, fn) {\n\tvar args = [].slice.call(arguments);\n\tfn = args.pop();\n\tenv = 'all'; \n\ttype = 'all';\n\n\tif(args.length > 0) {\n\t\tenv = args[0];\n\t}\n\tif(args.length > 1) {\n\t\ttype = args[1];\n\t}\n\n\tif (env === 'all' || env.indexOf(this.settings.env) >= 0) {\n\t\tif (type === 'all' || type.indexOf(this.settings.serverType) >= 0) {\n\t\t\tfn.call(this);\n\t\t}\n\t}\n\treturn this;\n};","params":[{"type":"param","types":["String"],"name":"env","description":"application environment "},{"type":"param","types":["Function"],"name":"fn","description":"callback function"},{"type":"param","types":["String"],"name":"type","description":"server type"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"env","description":"application environment "},{"type":"param","types":["Function"],"name":"fn","description":"callback function"},{"type":"param","types":["String"],"name":"type","description":"server type"},{"type":"return","types":["Application"],"description":"for chaining"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"167-1350527233716","name":"quit","signiture":"Application.quit()","type":"method","ctx":{"type":"method","receiver":"Application","name":"quit","string":"Application.quit()"},"description":{"full":"<p>Quit application in all servers</p>","summary":"<p>Quit application in all servers</p>","body":""},"full_description":"<p>Quit application in all servers</p>","code":"Application.quit = function () {\n\tvar servers = this.servers, cmd;\n\tfor (var serverType in servers) {\n\t\tif (serverType === 'master' || serverType === 'connector') {\n\t\t\tcontinue;\n\t\t}\n\t\tvar typeServers = servers[serverType];\n\t\tfor (var i = 0; i < typeServers.length; i++) {\n\t\t\tvar server = typeServers[i];\n\t\t\tif (server.host === '127.0.0.1' || server.host === 'localhost') {\n\t\t\t\tprocess.exit(1);\n\t\t\t} else {\n\t\t\t\tcmd = \"kill   -9   `ps   -ef | grep node|awk   '{print   $2}'`\";\n\t\t\t\tstarter.sshrun(cmd, server.host);\n\t\t\t}\n\t\t}\n\t}\n\ttry {\n\t\tcmd = \"kill   -9   `ps   -ef | grep node|awk   '{print   $2}'`\";\n\t\tstarter.run(cmd);\n\t\tprocess.exit(1);\n\t} catch (ex) {\n\t\tlogger.error('quit get error ' + ex);\n\t}\n};","params":[],"has_params":false,"tags":[{"type":"return","types":["Void"],"description":""},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true},{"id":"168-1350527233716","name":"kill","signiture":"Application.kill()","type":"method","ctx":{"type":"method","receiver":"Application","name":"kill","string":"Application.kill()"},"description":{"full":"<p>Kill application in all servers</p>","summary":"<p>Kill application in all servers</p>","body":""},"full_description":"<p>Kill application in all servers</p>","code":"Application.kill = function (pid, serverId) {\n\tvar servers = this.servers;\n\tfor (var serverType in servers) {\n\t\tvar typeServers = servers[serverType];\n\t\tfor (var i = 0; i < typeServers.length; i++) {\n\t\t\tvar server = typeServers[i];\n\t\t\tfor (var j = 0; j < serverId.length; j++) {\n\t\t\t\tif (server.id === serverId[j]) {\n\t\t\t\t\tvar cmd = 'kill -9 ' + pid[j];\n\t\t\t\t\tif (server.host === '127.0.0.1' || server.host === 'localhost') {\n\t\t\t\t\t\tstarter.localrun(cmd);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tstarter.sshrun(cmd, server.host);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};","params":[{"type":"param","types":["String"],"name":"pid","description":"server' pid"},{"type":"param","types":["String"],"name":"serverId","description":"serverId"}],"has_params":true,"tags":[{"type":"param","types":["String"],"name":"pid","description":"server' pid"},{"type":"param","types":["String"],"name":"serverId","description":"serverId"},{"type":"memberOf","parent":"Application"}],"module":false,"parent":"Application","related":{"href":""},"has_related":true}]}]
    </script>
    <!-- Array，String，Object扩展函数（因为IE9-不支持，而Lunr有使用到) -->
    <script src='js/extend.js'></script>
    <!-- 将原来引用网上的jquery转为引用本地的 -->
    <script src='js/jquery-1.6.4-min.js'></script>
    <!-- 将Lunr和页面逻辑整合一起放在lunr.js文件 -->
    <script src='js/lunr.js'></script>
  </head>
  <body>
    <!-- 顶栏 -->
    <div class="g-bar">
      <!-- 顶栏github模块 -->
      <div class="m-github">
          <span class="title">gitHub:</span><a class="link" target="_blank" href="#">http://github.com/NetEase/pomelo</a>
      </div>
    </div>
    <!-- 头部 -->
    <div class="g-hd">
      <div class="m-hdnav">
      		<div class="bg">
         	<div class="wrap">
          		<ul class="cnt">
          		  <li><a href="index.html">Home</a></li>
        		    <li class="current"><a href="page.html">API</a></li>
        		 	  <li><a href="#">Reference</a></li>
          		 	<li><a href="#">Guide</a></li>
          		  <li><a href="#">Applications</a></li>
            		<li><a href="#">community</a></li>
          		  <li><a href="#" class="last">FAQ</a></li>
          		</ul>	
         	 	</div>
          </div>
          <div class="logo"><a href="#"><div class="img"></div></a></div>
      </div>
    </div>
    <!-- 整体居中 -->
    <div class="g-doc">
      <!-- 主体 -->
      <div class="g-bd">
        <!-- API主体 -->
        <div class="m-wrap">
          <!-- API -->
          <div class='main'>
            <div class='maintt'>
              <h1>doxmake<span class='version'>0.0.1</span></h1>
            </div>
      
            
              <div class='cls' id='Pomelo'>
                <div class='clstt'>
                  <h2>Pomelo</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Expose <code>createApplication()</code>.</p>
                </div>
      
                
                  <div class='method' id='createApp'>
                    <div class='methodtt'>
                      <h3>createApp</h3>
                      <h4>Pomelo.createApp()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Create an pomelo application.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Pomelo.createApp = function () {
    var app = application;
    app.stack = [].slice.apply(arguments);
    app.init();
    self.app = app;
    return app;
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='StatusService'>
                <div class='clstt'>
                  <h2>StatusService</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Status service. keep all connection infos in memory. only one connection at the same time for each account. latest login will kick the old one off.</p>
                </div>
      
                
                  <div class='method' id='addStatus'>
                    <div class='methodtt'>
                      <h3>addStatus</h3>
                      <h4>StatusService.addStatus()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                          <li>serverId - sid</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add uid and serverId pair into status records kick the old login if any.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>StatusService.addStatus = function(uid, sid, cb) {
	logger.debug('add satus:' + uid + ', ' + sid);
	var oldSid = uidMap[uid];

	function addNewStatus(err) {
		if(!err) {
			uidMap[uid] = sid;
		}
		utils.invokeCallback(cb, err);
	}

	if(!!oldSid) {
		kick(uid, oldSid, addNewStatus);
	} else {
		addNewStatus();
	}

};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='removeStatus'>
                    <div class='methodtt'>
                      <h3>removeStatus</h3>
                      <h4>StatusService.removeStatus()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                          <li>cb(err) - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove status record by uid</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>StatusService.removeStatus = function(uid, cb) {
	delete uidMap[uid];

	utils.invokeCallback(cb);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='queryStatus'>
                    <div class='methodtt'>
                      <h3>queryStatus</h3>
                      <h4>StatusService.queryStatus()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Query status by uid</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>StatusService.queryStatus = function(uid, cb) {
	utils.invokeCallback(cb, null, uidMap[uid]);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='queryStatusBatch'>
                    <div class='methodtt'>
                      <h3>queryStatusBatch</h3>
                      <h4>StatusService.queryStatusBatch()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uids - list of uid</li>
                        
                          <li>cb - cb(err, result, missing) result:{sid:[uid]}, missing:[missingUid]</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Query status by uids</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>StatusService.queryStatusBatch = function(uids, cb) {
	var result = {};
	var missing = [];

	var sid, list;
	for(var i=0, l=uids.length; i&lt;l; i++) {
		sid = uidMap[uids[i]];
		if(!sid) {
			missing.push(uids[i]);
			continue;
		}

		list = result[sid];
		if(!list) {
			list = [];
			result[sid] = list;
		}
		list.push(uids[i]);
	}

	utils.invokeCallback(cb, null, result, missing);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='SessionService'>
                <div class='clstt'>
                  <h2>SessionService</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Manager session.</p>
                </div>
      
                
                  <div class='method' id='createSession'>
                    <div class='methodtt'>
                      <h3>createSession</h3>
                      <h4>SessionService.createSession()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>opts - {key:obj, uid: str, and etc.}</li>
                        
                          <li>force - whether replace the origin session if it already existed</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Create and return session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.createSession = function(opts, force) {
	if(!opts || !opts.key) {
		throw new Error('opts or opts.key should not be empty.');
	}

	if(!!socketMap[opts.key] &amp;&amp; !force) {
		return null;
	}

	var session = new InterSession(opts);
	socketMap[opts.key] = session;
	return session;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='getSession'>
                    <div class='methodtt'>
                      <h3>getSession</h3>
                      <h4>SessionService.getSession()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - the session' key</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get session by key.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.getSession = function(key) {
	return socketMap[key];
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='getSessionByUid'>
                    <div class='methodtt'>
                      <h3>getSessionByUid</h3>
                      <h4>SessionService.getSessionByUid()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get session by userId.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.getSessionByUid = function(uid) {
	return uidMap[uid];
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='removeSession'>
                    <div class='methodtt'>
                      <h3>removeSession</h3>
                      <h4>SessionService.removeSession()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - the session' key</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove session by key.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.removeSession = function(key) {
	delete socketMap[key];
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='kick'>
                    <div class='methodtt'>
                      <h3>kick</h3>
                      <h4>SessionService.kick()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                          <li>cb - callback function</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kick a user offline.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.kick = function(uid, cb) {
	logger.debug('kick off user:' + uid);
	var session = SessionService.getSessionByUid(uid);

	function afterKick() {
		utils.invokeCallback(cb);
	}

	if(!!session) {
		//make sure has been kicked
		kick(session);
	}
	process.nextTick(afterKick);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='sendMessage'>
                    <div class='methodtt'>
                      <h3>sendMessage</h3>
                      <h4>SessionService.sendMessage()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>id - session id</li>
                        
                          <li>msg - message to send</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Send message to the client by session id.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.sendMessage = function(id, msg) {
	if(!socketMap[id]) {
		logger.error('fail to send message for socket not exits');
		return false;
	}

	if(!!SessionService.sendDirectly) {
		socketMap[id].socket.send(encode(msg));
		return true;
	}

	var queue = msgQueues[id];
	if(!queue) {
		queue = [];
		msgQueues[id] = queue;
	}

	queue.push(msg);
	return true;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='sendMessageByUid'>
                    <div class='methodtt'>
                      <h3>sendMessageByUid</h3>
                      <h4>SessionService.sendMessageByUid()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                          <li>msg - message to send</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Send message to the client by user id.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>SessionService.sendMessageByUid = function(uid, msg) {
	var session = uidMap[uid];
	if(!session) {
		logger.error('fail to send message by uid for session not exist. uid: %j', uid);
		return false;
	}

	return SessionService.sendMessage(session.key, msg);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='InterSession'>
                <div class='clstt'>
                  <h2>InterSession</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Interal session class.</p>
                </div>
      
                
                  <div class='method' id='exportSession'>
                    <div class='methodtt'>
                      <h3>exportSession</h3>
                      <h4>InterSession.prototype.exportSession()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Export session's data field except key and socket.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.exportSession = function() {
	var res = {};

	for(var f in this) {
		if(f === 'key' || f === 'socket' || typeof this[f] === 'function') {
			continue;
		}

		res[f] = this[f];
	}
	  
	return res;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='cloneSession'>
                    <div class='methodtt'>
                      <h3>cloneSession</h3>
                      <h4>InterSession.prototype.cloneSession()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Clone session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.cloneSession = function() {
	var res = {};

	for(var f in this) {
		res[f] = this[f];
	}

	return res;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='bind'>
                    <div class='methodtt'>
                      <h3>bind</h3>
                      <h4>InterSession.prototype.bind()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - userId</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Bind the session with the the uid.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.bind = function(uid) {
	//get origin session instance
	var session = SessionService.getSession(this.key);
	if(!session) {
		return false;
	}

	if(session.uid) {
		return false;
	}
	set(this, 'uid', uid);
	uidMap[uid] = session;
	this.emit('bind', session);
	return true;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='set'>
                    <div class='methodtt'>
                      <h3>set</h3>
                      <h4>InterSession.prototype.set()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>key - session key</li>
                        
                          <li>value - session key</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Set value for the session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.set = function(key, value) {
	set(this, key, value);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='on'>
                    <div class='methodtt'>
                      <h3>on</h3>
                      <h4>InterSession.prototype.on()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Bind event for the session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.on = function() {
	var session = SessionService.getSession(this.key);
	if(!session) {
		return false;
	}
	EventEmitter.prototype.on.apply(session, arguments);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='emit'>
                    <div class='methodtt'>
                      <h3>emit</h3>
                      <h4>InterSession.prototype.emit()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Emit a event for the session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.emit = function() {
	var session = SessionService.getSession(this.key);
	if(!session) {
		return false;
	}
	EventEmitter.prototype.emit.apply(session, arguments);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='closing'>
                    <div class='methodtt'>
                      <h3>closing</h3>
                      <h4>InterSession.prototype.closing()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Closing callback for the session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.closing = function() {
	var reason = this.isKicked ? 'kick' : null;
	this.emit('closing', this, reason);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='closed'>
                    <div class='methodtt'>
                      <h3>closed</h3>
                      <h4>InterSession.prototype.closed()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Closed callback for the session.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>InterSession.prototype.closed = function() {
	if(!!this._closed) {
		return;
	}
	set(this, '_closed', true);
	set(this, 'uid', null);
	delete socketMap[this.key];
	delete msgQueues[this.key];

	var reason = this.isKicked ? 'kick' : null;
	this.emit('closed', this, reason);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='ChannelManager'>
                <div class='clstt'>
                  <h2>ChannelManager</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Manager and maintain channel.</p>
                </div>
      
                
                  <div class='method' id='createChannel'>
                    <div class='methodtt'>
                      <h3>createChannel</h3>
                      <h4>ChannelManager.createChannel()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel's name</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Create channel with name.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelManager.createChannel = function(name) {
	if(!!channels[name]) {
		return channels[name];
	}

	var c = new Channel(name);
	channels[name] = c;
	return c;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='getChannel'>
                    <div class='methodtt'>
                      <h3>getChannel</h3>
                      <h4>ChannelManager.getChannel()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel's name</li>
                        
                          <li>create - if true, create channel</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get channel by name.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelManager.getChannel = function(name, create) {
  var channel = channels[name];
  if(!channel &amp;&amp; !!create) {
    channel = channels[name] = new Channel(name);
  }
	return channel;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='destroyChannel'>
                    <div class='methodtt'>
                      <h3>destroyChannel</h3>
                      <h4>ChannelManager.destroyChannel()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>name - channel' name</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Destroy channel by name.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelManager.destroyChannel = function(name) {
  delete channels[name];
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='pushMessageByUids'>
                    <div class='methodtt'>
                      <h3>pushMessageByUids</h3>
                      <h4>ChannelManager.pushMessageByUids()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>msg - message that would be sent to client</li>
                        
                          <li>uids - [{uid: userId, sid: serverId}]</li>
                        
                          <li>cb - cb(err)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push message by uids. Group the uids by group. ignore any uid if sid not specified.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelManager.pushMessageByUids = function(msg, uids, cb) {
	if(!uids || uids.length === 0) {
		utils.invokeCallback(cb, new Error('uids should not be empty'));
		return;
	}
	var groups = {}, record;
	for(var i=0, l=uids.length; i&lt;l; i++) {
		record = uids[i];
		add(record.uid, record.sid, groups);
	}

	sendMessageByGroup(msg, groups, cb);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='Channel'>
                <div class='clstt'>
                  <h2>Channel</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Channel  maintains a number of user informations: userId, serverId and their mapping.   It is used to  broadcast message to users in the channel. </p>
                </div>
      
                
                  <div class='method' id='add'>
                    <div class='methodtt'>
                      <h3>add</h3>
                      <h4>Channel.prototype.add()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>sid - frontend server id which user has connected to</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Add user to channel.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Channel.prototype.add = function(uid, sid) {
  if(this.state &gt; ST_INITED) {
    return false;
  } else {
    return add(uid, sid, this.groups);
  }
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='leave'>
                    <div class='methodtt'>
                      <h3>leave</h3>
                      <h4>Channel.prototype.leave()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>uid - user id</li>
                        
                          <li>sid - frontend server id which user has connected to. </li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Remove user from channel.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Channel.prototype.leave = function(uid, sid) {
	return deleteFrom(uid, sid, this.groups[sid]);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='destroy'>
                    <div class='methodtt'>
                      <h3>destroy</h3>
                      <h4>Channel.prototype.destroy()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Destroy channel.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Channel.prototype.destroy = function() {
  this.state = ST_DESTROYED;
  ChannelManager.destroyChannel(this.name);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='pushMessage'>
                    <div class='methodtt'>
                      <h3>pushMessage</h3>
                      <h4>Channel.prototype.pushMessage()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>{Object} - message that would be sent to client</li>
                        
                          <li>{Functioin} - cb(err)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push message to all the members in the channel</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Channel.prototype.pushMessage = function(msg, cb) {
	sendMessageByGroup(msg, this.groups, cb);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='ChannelService'>
                <div class='clstt'>
                  <h2>ChannelService</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Manager localChannel and push message.</p>
                </div>
      
                
                  <div class='method' id='getLocalChannelSync'>
                    <div class='methodtt'>
                      <h3>getLocalChannelSync</h3>
                      <h4>ChannelService.getLocalChannelSync()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>opts - channel info parameters {name: channelName, create: createIfNotExist}</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get local channel instance.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelService.getLocalChannelSync = function(opts) {
  return channelManager.getChannel(opts.name, opts.create);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='pushMessageByUids'>
                    <div class='methodtt'>
                      <h3>pushMessageByUids</h3>
                      <h4>ChannelService.pushMessageByUids()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>msg - message that would be sent to client</li>
                        
                          <li>uids - [{uid: userId, sid: serverId}] or [uids]</li>
                        
                          <li>cb - cb(err)</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Push message by uids. Group the uids by group. query status server for sid if sid not specified.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>ChannelService.pushMessageByUids = function(msg, uids, cb) {
  channelManager.pushMessageByUids(msg, uids, cb);
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
              <div class='cls' id='Application'>
                <div class='clstt'>
                  <h2>Application</h2>
                </div>
      
                <div class='clsdes'>
                  <p>Application prototype.</p>
                </div>
      
                
                  <div class='method' id='set'>
                    <div class='methodtt'>
                      <h3>set</h3>
                      <h4>Application.set()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - the setting of application</li>
                        
                          <li>val - the setting's value</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value. Mounted servers inherit their parent server's settings.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.set = function (setting, val) {
	if (1 == arguments.length) {
		if (this.settings.hasOwnProperty(setting)) {
			return this.settings[setting];
		} else if (this.parent) {
			return this.parent.set(setting);
		}
	} else {
		this.settings[setting] = val;
		this[setting] = val;
		return this;
	}
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='get'>
                    <div class='methodtt'>
                      <h3>get</h3>
                      <h4>Application.get()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Get property from setting</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.get = function (setting) {
	var val = this.settings[setting];
	return val;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='enabled'>
                    <div class='methodtt'>
                      <h3>enabled</h3>
                      <h4>Application.enabled()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check if <code>setting</code> is enabled.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.enabled = function (setting) {
	return !!this.set(setting);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='disabled'>
                    <div class='methodtt'>
                      <h3>disabled</h3>
                      <h4>Application.disabled()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Check if <code>setting</code> is disabled.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.disabled = function (setting) {
	return !this.set(setting);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='enable'>
                    <div class='methodtt'>
                      <h3>enable</h3>
                      <h4>Application.enable()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Enable <code>setting</code>.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.enable = function (setting) {
	return this.set(setting, true);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='disable'>
                    <div class='methodtt'>
                      <h3>disable</h3>
                      <h4>Application.disable()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>setting - application setting</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Disable <code>setting</code>.</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.disable = function (setting) {
	return this.set(setting, false);
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='configure'>
                    <div class='methodtt'>
                      <h3>configure</h3>
                      <h4>Application.configure()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>env - application environment </li>
                        
                          <li>fn - callback function</li>
                        
                          <li>type - server type</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Configure callback for the specified env and server type.  When no env is specified that callback will be invoked for all environments and when no type is specified  that callback will be invoked for all server types. </p>

<h2>Examples</h2>

<p>app.configure(function(){      // executed for all envs and server types    });</p>

<p>app.configure('development', function(){      // executed development env    });</p>

<p>app.configure('development', 'connector', function(){      // executed for development env and connector server type    });</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.configure = function (env, type, fn) {
	var args = [].slice.call(arguments);
	fn = args.pop();
	env = 'all'; 
	type = 'all';

	if(args.length &gt; 0) {
		env = args[0];
	}
	if(args.length &gt; 1) {
		type = args[1];
	}

	if (env === 'all' || env.indexOf(this.settings.env) &gt;= 0) {
		if (type === 'all' || type.indexOf(this.settings.serverType) &gt;= 0) {
			fn.call(this);
		}
	}
	return this;
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='quit'>
                    <div class='methodtt'>
                      <h3>quit</h3>
                      <h4>Application.quit()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                      <ul>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Quit application in all servers</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.quit = function () {
	var servers = this.servers, cmd;
	for (var serverType in servers) {
		if (serverType === 'master' || serverType === 'connector') {
			continue;
		}
		var typeServers = servers[serverType];
		for (var i = 0; i &lt; typeServers.length; i++) {
			var server = typeServers[i];
			if (server.host === '127.0.0.1' || server.host === 'localhost') {
				process.exit(1);
			} else {
				cmd = &quot;kill   -9   `ps   -ef | grep node|awk   '{print   $2}'`&quot;;
				starter.sshrun(cmd, server.host);
			}
		}
	}
	try {
		cmd = &quot;kill   -9   `ps   -ef | grep node|awk   '{print   $2}'`&quot;;
		starter.run(cmd);
		process.exit(1);
	} catch (ex) {
		logger.error('quit get error ' + ex);
	}
};</code></pre>
                    </div>
                    
                  </div>
                
                  <div class='method' id='kill'>
                    <div class='methodtt'>
                      <h3>kill</h3>
                      <h4>Application.kill()</h4>
                      <p class='type'>type: method</p>
                    </div>
      
                    <div class='params'>
                      
                        <h4>Params</h4>
                      
                      <ul>
                        
                          <li>pid - server' pid</li>
                        
                          <li>serverId - serverId</li>
                        
                      </ul>
                    </div>
      
                    
      
                    <div>
                      <p>Kill application in all servers</p>
                    </div>
      
                    <div class='source'>
                      <h4>Source</h4>
                      <pre><code>Application.kill = function (pid, serverId) {
	var servers = this.servers;
	for (var serverType in servers) {
		var typeServers = servers[serverType];
		for (var i = 0; i &lt; typeServers.length; i++) {
			var server = typeServers[i];
			for (var j = 0; j &lt; serverId.length; j++) {
				if (server.id === serverId[j]) {
					var cmd = 'kill -9 ' + pid[j];
					if (server.host === '127.0.0.1' || server.host === 'localhost') {
						starter.localrun(cmd);
					}
					else {
						starter.sshrun(cmd, server.host);
					}
				}
			}
		}
	}
};</code></pre>
                    </div>
                    
                  </div>
                
              </div>
            
          </div>
          <!-- API导航 -->
          <div class='side'>
            <div class='m-nav'>
              <div class='m-search'>
                <input type="text" id="search-input" placeholder="Search"></input>
                <div id="search-results"></div>
              </div>
              <ul>
                
                  <li>
                    <h3><a target='Pomelo' class='cap'>Pomelo</a></h3>
                    <ul>
                      
                        <li><a target='createApp'>createApp</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='StatusService' class='cap'>StatusService</a></h3>
                    <ul>
                      
                        <li><a target='addStatus'>addStatus</a></li>
                      
                        <li><a target='removeStatus'>removeStatus</a></li>
                      
                        <li><a target='queryStatus'>queryStatus</a></li>
                      
                        <li><a target='queryStatusBatch'>queryStatusBatch</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='SessionService' class='cap'>SessionService</a></h3>
                    <ul>
                      
                        <li><a target='createSession'>createSession</a></li>
                      
                        <li><a target='getSession'>getSession</a></li>
                      
                        <li><a target='getSessionByUid'>getSessionByUid</a></li>
                      
                        <li><a target='removeSession'>removeSession</a></li>
                      
                        <li><a target='kick'>kick</a></li>
                      
                        <li><a target='sendMessage'>sendMessage</a></li>
                      
                        <li><a target='sendMessageByUid'>sendMessageByUid</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='InterSession' class='cap'>InterSession</a></h3>
                    <ul>
                      
                        <li><a target='exportSession'>exportSession</a></li>
                      
                        <li><a target='cloneSession'>cloneSession</a></li>
                      
                        <li><a target='bind'>bind</a></li>
                      
                        <li><a target='set'>set</a></li>
                      
                        <li><a target='on'>on</a></li>
                      
                        <li><a target='emit'>emit</a></li>
                      
                        <li><a target='closing'>closing</a></li>
                      
                        <li><a target='closed'>closed</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='ChannelManager' class='cap'>ChannelManager</a></h3>
                    <ul>
                      
                        <li><a target='createChannel'>createChannel</a></li>
                      
                        <li><a target='getChannel'>getChannel</a></li>
                      
                        <li><a target='destroyChannel'>destroyChannel</a></li>
                      
                        <li><a target='pushMessageByUids'>pushMessageByUids</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='Channel' class='cap'>Channel</a></h3>
                    <ul>
                      
                        <li><a target='add'>add</a></li>
                      
                        <li><a target='leave'>leave</a></li>
                      
                        <li><a target='destroy'>destroy</a></li>
                      
                        <li><a target='pushMessage'>pushMessage</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='ChannelService' class='cap'>ChannelService</a></h3>
                    <ul>
                      
                        <li><a target='getLocalChannelSync'>getLocalChannelSync</a></li>
                      
                        <li><a target='pushMessageByUids'>pushMessageByUids</a></li>
                      
                    </ul>
                  </li>
                
                  <li>
                    <h3><a target='Application' class='cap'>Application</a></h3>
                    <ul>
                      
                        <li><a target='set'>set</a></li>
                      
                        <li><a target='get'>get</a></li>
                      
                        <li><a target='enabled'>enabled</a></li>
                      
                        <li><a target='disabled'>disabled</a></li>
                      
                        <li><a target='enable'>enable</a></li>
                      
                        <li><a target='disable'>disable</a></li>
                      
                        <li><a target='configure'>configure</a></li>
                      
                        <li><a target='quit'>quit</a></li>
                      
                        <li><a target='kill'>kill</a></li>
                      
                    </ul>
                  </li>
                
              </ul>
            </div>
          </div>
        </div>
        <!-- page四列模块 -->
        <div class="m-4col">
          <div class="col">
            <h2>About</h2>
            <p>Place your blog information here. This is the "Bottom Column 1" widget area. There are 4 bottom cloumn areas. You can drag and drag widgets to any of these 4 column. As these footer columns use "Smart Columns", they'll automatically resize beautifully no matter if you use 1,2,3 or 4 columns.</p>
          </div>
          <div class="col">
            <h2>blogroll</h2>
            <p><a href="#">Documentation</a></p>
            <p><a href="#">Plugins</a></p>
            <p><a href="#">Suggest Ideas</a></p>
            <p><a href="#">Support Forum</a></p>
            <p><a href="#">Themes</a></p>
            <p><a href="#">WordPress Blog</a></p>
            <p><a href="#">WordPress Planet</a></p>
          </div>
          <div class="col">
            <h2>Recent Posts</h2>
            <p><a href="#">Praesent mollis mauris eget</a></p>
            <p><a href="#">Phasellus et tellus nisl</a></p>
            <p><a href="#">Donec nibh sapien</a></p>
            <p><a href="#">Hello world!</a></p>
          </div>
          <div class="col last">
            <h2>Meta</h2>
            <p><a href="#">Login</a></p>
            <p><a href="#">Entries RSS</a></p>
            <p><a href="#">comments RSS</a></p>
            <p><a href="#">WordPress.org</a></p>
            <p>I'm using <a href="#">AdRotate</a></p>
          </div>
        </div>
      </div>
    </div>
    <!-- 尾部 -->
    <div class="g-ft">
      <!-- 尾部模块 -->
      <div class="m-ft">
          Pomelo by Netease, Inc. Rleased under the MIT license -Copyright © Netease 2012
      </div>
    </div>
    <!-- 向上图标 -->
    <div class='m-arrow f-dn'><a href="#"></a></div>
    <!-- 代码高亮模块 -->
    <script src='js/hijs.js'></script>
    <!-- 页面效果模块 -->
    <script src='js/api.js'></script>
  </body>
</html>

