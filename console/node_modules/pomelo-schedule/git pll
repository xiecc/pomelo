[1mdiff --git a/lib/cronTriggerDecoder.js b/lib/cronTriggerDecoder.js[m
[1mdeleted file mode 100644[m
[1mindex 9af89cb..0000000[m
[1m--- a/lib/cronTriggerDecoder.js[m
[1m+++ /dev/null[m
[36m@@ -1,225 +0,0 @@[m
[31m-var decoder = module.exports;[m
[31m-decoder.decodeCronTime = decodeCronTime;[m
[31m-[m
[31m-var timer = {[m
[31m-  second: -1,[m
[31m-  min: -1,[m
[31m-  hour: -1,[m
[31m-  dom: -1,[m
[31m-  month: -1,[m
[31m-  dow: -1,[m
[31m-  executeTime: -1[m
[31m-}[m
[31m-[m
[31m-var limit = [[0,59],[0,59],[0,24],[1,31],[1,12],[0,6]];[m
[31m-[m
[31m-function nexExcuteTime(time, timer){[m
[31m-  //add 1s to the time so it must be the next time[m
[31m-  time += 1000;[m
[31m-  var date = new Date(time);[m
[31m-  var nextTime = new Date(time);[m
[31m-[m
[31m-  outmost:[m
[31m-  while(true){[m
[31m-    if(!timeMatch(date.getMonth(), timer.month)){[m
[31m-      var nextMonth = nextTime(date.getMonth(), timer.month);[m
[31m-      if(nextMonth < date.getMonth()){[m
[31m-        date.setYear(date.getYear()+1);[m
[31m-      }[m
[31m-      date.setMonth(nextMonth);[m
[31m-      [m
[31m-      date.setDate(1);[m
[31m-      date.setHours(0);        [m
[31m-      date.setMinutes(0);[m
[31m-      date.setSeconds(0);[m
[31m-    }[m
[31m-      [m
[31m-    if(!timeMatch(date.getDate(), timer.dom)){[m
[31m-      do{[m
[31m-        var nextDom = nextTime(date.getDate(), timer.dom);[m
[31m-    [m
[31m-        //If the date is in the next month, add month[m
[31m-        if(nextDom <= date.getDate()){[m
[31m-          date.setMonth(date.getMonth() + 1);[m
[31m-          continue outmost;[m
[31m-        }[m
[31m-       [m
[31m-        //If the date exceed the limit, add month[m
[31m-         var domLimit = getDomLimit();[m
[31m-        if(nexDom > domLimit){[m
[31m-           date.setMonth(date.getMonth() + 1);[m
[31m-          continue outmost;[m
[31m-        }[m
[31m- [m
[31m-         date.setDate(nextDom);[m
[31m-      }while(!timeMatch(date.getDay(), timer.dow));[m
[31m-     [m
[31m-      date.setHours(0);        [m
[31m-      date.setMinutes(0);[m
[31m-      date.setSeconds(0); [m
[31m-    }[m
[31m-    [m
[31m-    if(!timeMatch(date.getHours(), timer.hour)){[m
[31m-      var nextHour = nextTime(date.getHours(), timer.hour);[m
[31m-     [m
[31m-      if(nextHour <= date.getHours()){[m
[31m-         date.setDate(date.getDate() + 1);[m
[31m-         continue;[m
[31m-      }[m
[31m-      [m
[31m-      date.setHours(nextHour);[m
[31m-      date.setMinutes(0);[m
[31m-      date.setSeconds(0);[m
[31m-    }[m
[31m-    [m
[31m-    if(!timeMatch(date.getMinutes(), timer.minute)){[m
[31m-      var nextMinute = nextTime(date.getMinutes(), timer.minute);[m
[31m-     [m
[31m-      if(nextMinute <= date.getMinutes()){[m
[31m-         date.setHours(date.getHours() + 1);[m
[31m-         continue;[m
[31m-      }[m
[31m-      [m
[31m-      date.setMinutes(nextMinute);[m
[31m-      date.setSeconds(0);[m
[31m-    }[m
[31m-    [m
[31m-    if(!timeMatch(date.getSeconds(), timer.seconde)){[m
[31m-      var nextSecond = nextTime(date.getSeconds(), timer.seconde);[m
[31m-     [m
[31m-      if(nextSecond <= date.getSeconds()){[m
[31m-         date.setMinutes()(date.getMinutes() + 1);[m
[31m-         continue;[m
[31m-      }[m
[31m-      [m
[31m-      date.setSeconds(nextSecond);[m
[31m-    }[m
[31m-    [m
[31m-    break;[m
[31m-  }[m
[31m-  [m
[31m-  return date.getTime();[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * return the next match time of the given value[m
[31m- */[m
[31m-function nextTime(value, cronTime){[m
[31m-  if(typeof(cronTime) == 'number'){[m
[31m-    if(cronTime == -1)[m
[31m-      return value + 1;[m
[31m-    else[m
[31m-      return cronTime;[m
[31m-  }else if(typeof(cronTime) == 'array'){[m
[31m-    if(value < arr[0] || value > arr[arr.length -1])[m
[31m-      return arr[0];[m
[31m-    [m
[31m-    for(var i = 0; i < arr.length; i++)[m
[31m-      if(value < arr[i])[m
[31m-        return arr[i];[m
[31m-  }[m
[31m-  [m
[31m-  return null;[m
[31m-}[m
[31m-[m
[31m-function timeMatch(value, cronTime){[m
[31m-   if(tyeof(cronTime) == 'number'){[m
[31m-    if(cronTime == -1)[m
[31m-      return true;[m
[31m-    if(value == cronTime)[m
[31m-      return true;[m
[31m-    return false;[m
[31m-  }else if(typeof(cronTime) == 'array'){[m
[31m-    if(value < arr[0] || value > arr[arr.length -1])[m
[31m-      return false;[m
[31m-    [m
[31m-    for(var i = 0; i < arr.length; i++)[m
[31m-      if(value == arr[i])[m
[31m-        return true;[m
[31m-        [m
[31m-    return false;[m
[31m-  }[m
[31m-  [m
[31m-  return null;[m
[31m-}[m
[31m-[m
[31m-function getDomLimit(year, month){[m
[31m-  var date = new Date(year, month, 0);[m
[31m-  [m
[31m-  return date.getDate();[m
[31m-}[m
[31m-[m
[31m-function decodeCronTime(cronTime){[m
[31m-  var timers = cronTime.split(/\s+/);[m
[31m-  [m
[31m-  if(timers.length != 6){[m
[31m-    return null;[m
[31m-  }[m
[31m-  [m
[31m-  for(var i = 0; i < timers.length; i++){[m
[31m-    timers[i] = (decodeTimeStr(timers[i]));[m
[31m-    [m
[31m-    if(!checkNum(timers[i], limit[i][0], limit[i][1])){[m
[31m-      return null;[m
[31m-    }[m
[31m-  }[m
[31m-  [m
[31m-  return timers;[m
[31m-}[m
[31m-[m
[31m-function decodeTimeStr(timeStr){  [m
[31m-  var result = {};[m
[31m-  var arr = [];[m
[31m-  [m
[31m-  if(timeStr=='*'){[m
[31m-    return -1;[m
[31m-  }else if(timeStr.search(',')>0){[m
[31m-    var timeStrArray = timeStr.split(',');[m
[31m-    for(var i = 0; i < timeStrArray.length; i++){[m
[31m-      var time = timeStrArray[i];[m
[31m-      if(time.match(/^\d+-\d+$/)){[m
[31m-        decodeRangeTime(result, time);[m
[31m-      }else if(!isNaN(timeStrArray[i]))[m
[31m-        result[i] = time;[m
[31m-      else[m
[31m-        return null;[m
[31m-    }[m
[31m-  }else if(timeStr.match(/^\d+-\d+$/)){[m
[31m-    decodeRangeTime(result, time);[m
[31m-  }else if(!isNaN(timeStr)){[m
[31m-    result[timeStr] = timeStr;[m
[31m-  }else{[m
[31m-    return null;[m
[31m-  }  [m
[31m-  [m
[31m-  for(var key in result)[m
[31m-    arr.push(result[key]);[m
[31m-      [m
[31m-  arr.sort();[m
[31m-  [m
[31m-  return arr;[m
[31m-}[m
[31m-[m
[31m-function decodeRangeTime(map, timeStr){[m
[31m-  var times = timeStr.split('-');[m
[31m-  [m
[31m-  if(times[0] > times[1])[m
[31m-    return null;[m
[31m-  for(var i = times[0]; i <= times[1]; i++)[m
[31m-    map[i] = i;[m
[31m-}[m
[31m-[m
[31m-function checkNum(nums, min, max){[m
[31m-  if(nums == null)[m
[31m-    return false;[m
[31m-    [m
[31m-  if(nums == -1)[m
[31m-    return true;[m
[31m-  [m
[31m-  for(var i = 0; i < nums.length; i++){[m
[31m-    if(nums[i]<min || nums[i]>max)[m
[31m-      return false;[m
[31m-  }[m
[31m-  [m
[31m-  return true;[m
[31m-}[m
\ No newline at end of file[m
[1mdiff --git a/package.json b/package.json[m
[1mindex 97edf88..4c25e43 100644[m
[1m--- a/package.json[m
[1m+++ b/package.json[m
[36m@@ -1,6 +1,6 @@[m
 {[m
   "name": "pomelo-schedule",[m
[31m-  "version": "0.3.0",[m
[32m+[m[32m  "version": "0.3.1",[m
   "main": "./lib/schedule",[m
   "author": "XiaogangZhang <zhang0925@gmail.com>",[m
   "dependencies": {[m
[1mdiff --git a/test/CronTriggerTest.js b/test/CronTriggerTest.js[m
[1mindex 6c79bbf..f05fb5d 100644[m
[1m--- a/test/CronTriggerTest.js[m
[1m+++ b/test/CronTriggerTest.js[m
[36m@@ -10,9 +10,9 @@[m [mvar DOW = 5;[m
 function decoderTest(){[m
   var result = [];[m
   [m
[31m-  result.push(cronTrigger.decodeTrigger('12    2 3,4,5 4 5 1'));[m
[32m+[m[32m  result.push(cronTrigger.decodeTrigger('12 2 3,4,5 4 5 1'));[m
   [m
[31m-  result.push(cronTrigger.decodeTrigger('*    1-3,2-9,4 3,4,5 4-9 5 1'));[m
[32m+[m[32m  result.push(cronTrigger.decodeTrigger('* 1-3,2-9,4 3,4,5 4-9 5 1'));[m
   [m
   result.push(cronTrigger.decodeTrigger('12    2 3 4 5 1'));[m
   console.log(result);[m
